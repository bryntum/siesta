<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>&quot;src/guides/siesta_test_advanced/siesta_test_advanced&quot; | @bryntum/siesta</title>
	<meta name="description" content="Documentation for @bryntum/siesta">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../assets/js/search.json" data-base="..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../index.html" class="title">@bryntum/siesta</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../globals.html">Globals</a>
				</li>
				<li>
					<a href="_src_guides_siesta_test_advanced_siesta_test_advanced_.html">&quot;src/guides/siesta_test_advanced/siesta_test_advanced&quot;</a>
				</li>
			</ul>
			<h1>Module &quot;src/guides/siesta_test_advanced/siesta_test_advanced&quot;</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<section class="tsd-panel-group tsd-index-group">
				<h2>Index</h2>
				<section class="tsd-panel tsd-index-panel">
					<div class="tsd-index-content">
						<section class="tsd-index-section ">
							<h3>Variables</h3>
							<ul class="tsd-index-list">
								<li class="tsd-kind-variable tsd-parent-kind-module"><a href="_src_guides_siesta_test_advanced_siesta_test_advanced_.html#siestatestadvancedguide" class="tsd-kind-icon">Siesta<wbr>Test<wbr>Advanced<wbr>Guide</a></li>
							</ul>
						</section>
					</div>
				</section>
			</section>
			<section class="tsd-panel-group tsd-member-group ">
				<h2>Variables</h2>
				<section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-module">
					<a name="siestatestadvancedguide" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagConst">Const</span> Siesta<wbr>Test<wbr>Advanced<wbr>Guide</h3>
					<div class="tsd-signature tsd-kind-icon">Siesta<wbr>Test<wbr>Advanced<wbr>Guide<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">""</span><span class="tsd-signature-symbol"> = &quot;&quot;</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in src/guides/siesta_test_advanced/siesta_test_advanced.ts:4</li>
						</ul>
					</aside>
					<div class="tsd-comment tsd-typography">
						<div class="lead">
							<a href="#siesta-common-concepts" id="siesta-common-concepts" style="color: inherit; text-decoration: none;">
								<h1>Siesta common concepts</h1>
							</a>
							<p>This guide contains the more advanced concepts about Siesta tests. It does not target any specific execution environment, like browser or Node.js, instead it assumes plain EcmaScript setup.</p>
							<p>For introductory information, please refer to the <a href="_src_guides_siesta_test_basics_siesta_test_basics_.html#siestatestbasicsguide">Siesta test basics</a> guide.</p>
							<a href="#testing-asynchronous-code" id="testing-asynchronous-code" style="color: inherit; text-decoration: none;">
								<h1>Testing asynchronous code</h1>
							</a>
							<p>In the simplest form, when testing the asynchronous code, you can just make your test function <code>async</code> and use <code>await</code> where needed:</p>
							<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { it } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;siesta/index.js&quot;</span>
<span class="hljs-keyword">import</span> { MyClass } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;my-lib&quot;</span>

it(<span class="hljs-string">&#x27;Testing promise-based asynchronous code&#x27;</span>, <span class="hljs-keyword">async</span> t =&gt; {
    <span class="hljs-keyword">const</span> myClass       = <span class="hljs-keyword">new</span> MyClass()

    <span class="hljs-keyword">await</span> myClass.asyncMethod(<span class="hljs-string">&#x27;do something&#x27;</span>)
})</code></pre>
							<p>Sometimes, for example if code is using callbacks, you might not have the <code>Promise</code> instance to <code>await</code> for. In such case, use a pair of
								<a href="../classes/_src_siesta_test_test_.test.html#beginasync">beginAsync</a>/<a href="../classes/_src_siesta_test_test_.test.html#endasync">endAsync</a> calls to indicate the beginning/ending of the asynchronous &quot;gap&quot; in the code flow.
							Siesta will await for all <a href="../classes/_src_siesta_test_test_.test.html#beginasync">beginAsync</a> calls to complete with the corresponding <a href="../classes/_src_siesta_test_test_.test.html#endasync">endAsync</a>, before finalizing the test.</p>
							<p>For example:</p>
							<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { it } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;siesta/index.js&quot;</span>
<span class="hljs-keyword">import</span> { MyClass } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;my-lib&quot;</span>

it(<span class="hljs-string">&#x27;Testing callbacks-based asynchronous code&#x27;</span>, <span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> myClass        = <span class="hljs-keyword">new</span> MyClass()

    <span class="hljs-comment">// indicate async gap starts, test will remain active till</span>
    <span class="hljs-comment">// `endAsync()` call (but no longer than defatul timeout)</span>
    <span class="hljs-keyword">const</span> gap           = t.beginAsync()

    myClass.asyncMethodWithCallback(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// indicate async gap completes</span>
        t.endAsync(gap)
    })
})</code></pre>
							<a href="#tests-configuration" id="tests-configuration" style="color: inherit; text-decoration: none;">
								<h1>Tests configuration</h1>
							</a>
							<p>The configuration object of the nested test section &quot;extends&quot; the configuration object of the parent section. </p>
							<p>For example if parent section sets the <a href="../classes/_src_siesta_test_testdescriptor_.testdescriptor.html#defaulttimeout">defaultTimeout</a> to a certain value, the nested section
							will use that value too.</p>
							<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { it } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;siesta/index.js&quot;</span>

it({ <span class="hljs-attr">title</span> : <span class="hljs-string">&#x27;Test section&#x27;</span>, <span class="hljs-attr">defaultTimeout</span> : <span class="hljs-number">1000</span> }, <span class="hljs-keyword">async</span> t =&gt; {
    t.it(<span class="hljs-string">&#x27;Nested test section&#x27;</span>, <span class="hljs-keyword">async</span> t =&gt; {
        <span class="hljs-comment">// will fail within 1s</span>
        <span class="hljs-keyword">await</span> t.waitFor(<span class="hljs-function">() =&gt;</span> <span class="hljs-literal">false</span>)
    })
})</code></pre>
							<a href="#exceptions" id="exceptions" style="color: inherit; text-decoration: none;">
								<h1>Exceptions</h1>
							</a>
							<p>If you need to verify that some function throws the exception, use the <a href="../classes/_src_siesta_test_test_.test.html#throws">throws</a> assertion.
							In the similar way, to verify that function does not throw exception, there&#39;s <a href="../classes/_src_siesta_test_test_.test.html#doesnotthrow">doesNotThrow</a>. </p>
							<p>Also, the test code may throw some unexpected exception. If it is thrown from the test function, it is caught
								and reported in the test results log. This is also true for the promise rejections in the <code>async</code> test function
							code flow. These are &quot;normal&quot; exceptions, since they can be caught with the <code>try/catch</code> block on the test function.</p>
							<p>For example:</p>
							<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { it } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;siesta/index.js&quot;</span>

it(<span class="hljs-string">&#x27;Test section&#x27;</span>, <span class="hljs-keyword">async</span> t =&gt; {
    <span class="hljs-comment">// &quot;normal&quot; exception</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;I&#x27;m exceptional&quot;</span>)
})</code></pre>
							<p>However, test code may throw exception in the way, that it can not be caught using <code>try/catch</code> on the test function.
								This is the case for example, if exception is thrown in <code>setTimeout</code> handler, or if the new <code>Promise</code> instance,
							not included in the test function code flow, is rejected.</p>
							<p>For example:</p>
							<pre><code class="language-javascript"><span class="hljs-keyword">import</span> { it } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;siesta/index.js&quot;</span>

it(<span class="hljs-string">&#x27;Test section 1&#x27;</span>, <span class="hljs-keyword">async</span> t =&gt; {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// exception is thrown after 3s, </span>
        <span class="hljs-comment">// there might be some other test running by that time</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Oh, no&#x27;</span>)
    }, <span class="hljs-number">3000</span>)
})

it(<span class="hljs-string">&#x27;Test section 1&#x27;</span>, <span class="hljs-keyword">async</span> t =&gt; {
    <span class="hljs-comment">// promise outside of the test function code flow</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(reject, <span class="hljs-number">3000</span>)
    })
})</code></pre>
							<p>These are so called &quot;unhandled&quot; exceptions/rejections. If environment supports that (browsers and Node.js do, Deno doesn&#39;t),
								Siesta tracks such &quot;unhandled&quot; exceptions and report them <em>in the results log of the currently running test</em>.
								That might not be a test that was the cause of the exception! Unfortunately there&#39;s no easy way to determine
							the test that caused the &quot;unhandled&quot; exception. We might revisit this topic in the following releases.</p>
							<a href="#logging" id="logging" style="color: inherit; text-decoration: none;">
								<h1>Logging</h1>
							</a>
							<p>The <a href="../classes/_src_siesta_test_test_.test.html">Test</a> class implements the <a href="../classes/_src_logger_logger_.logger.html">Logger</a> mixin. One can use the <a href="../classes/_src_logger_logger_.logger.html">Logger</a> methods to report some useful information from tests.</p>
							<p>Note, that only the log messages which are the current log level (or higher) are reported. The current log level is determined with the
							<code>--log-level</code> command line option.</p>
							<a href="#console-and-stdoutstderr-output" id="console-and-stdoutstderr-output" style="color: inherit; text-decoration: none;">
								<h1>Console and stdout/stderr output</h1>
							</a>
							<p>If test performs calls to console, like <code>console.log()</code> or writes to <code>stdout/stderr</code>, Siesta intercepts such calls/writes
							and routes them into the test log. </p>
							<a href="#project" id="project" style="color: inherit; text-decoration: none;">
								<h1>Project</h1>
							</a>
							<p>If you want to provide configuration for the whole test suite, you need to create a <a href="_src_guides_siesta_project_siesta_project_.html#siestaprojectguide">Siesta project</a>.</p>
							<a href="#copyright-and-license" id="copyright-and-license" style="color: inherit; text-decoration: none;">
								<h1>COPYRIGHT AND LICENSE</h1>
							</a>
							<p>MIT License</p>
							<p>Copyright (c) 2009-2021 Bryntum, Nickolay Platonov</p>
						</div>
					</div>
				</section>
			</section>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="../globals.html"><em>Globals</em></a>
					</li>
					<li class="current tsd-kind-module">
						<a href="_src_guides_siesta_test_advanced_siesta_test_advanced_.html">&quot;src/guides/siesta_<wbr>test_<wbr>advanced/siesta_<wbr>test_<wbr>advanced&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-variable tsd-parent-kind-module">
						<a href="_src_guides_siesta_test_advanced_siesta_test_advanced_.html#siestatestadvancedguide" class="tsd-kind-icon">Siesta<wbr>Test<wbr>Advanced<wbr>Guide</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../assets/js/search.js"><' + '/script>');</script>
</body>
</html>