<!DOCTYPE html><html class="default no-js"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Guide: Testing advanced | @bryntum/siesta</title><meta name="description" content="Documentation for @bryntum/siesta"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><link rel="stylesheet" href="../assets/custom.css"/><script async src="../assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">@bryntum/siesta</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><ul class="tsd-breadcrumb"><li><a href="../modules.html">@bryntum/siesta</a></li><li><a href="Guide__Testing_advanced.html">Guide: Testing advanced</a></li></ul><h1>Module Guide: Testing advanced</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><section class="tsd-panel-group tsd-index-group"><h2>Index</h2><section class="tsd-panel tsd-index-panel"><div class="tsd-index-content"><section class="tsd-index-section "><h3>Variables</h3><ul class="tsd-index-list"><li class="tsd-kind-variable tsd-parent-kind-module"><a href="Guide__Testing_advanced.html#SiestaTestAdvancedGuide" class="tsd-kind-icon">Siesta<wbr/>Test<wbr/>Advanced<wbr/>Guide</a></li></ul></section></div></section></section><section class="tsd-panel-group tsd-member-group "><h2>Variables</h2><section class="tsd-panel tsd-member tsd-kind-variable tsd-parent-kind-module"><a id="SiestaTestAdvancedGuide" class="tsd-anchor"></a><h3>Siesta<wbr/>Test<wbr/>Advanced<wbr/>Guide</h3><div class="tsd-signature tsd-kind-icon">Siesta<wbr/>Test<wbr/>Advanced<wbr/>Guide<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">&quot;&quot;</span><span class="tsd-signature-symbol"> = &#39;&#39;</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/bryntum/siesta/blob/190b64e/packages/siesta/src/guides/siesta_test_advanced/siesta_test_advanced.ts#L7">siesta/src/guides/siesta_test_advanced/siesta_test_advanced.ts:7</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">

<a href="#siesta-common-concepts" id="siesta-common-concepts" style="color: inherit; text-decoration: none;">
  <h1>Siesta common concepts</h1>
</a>
<p>This guide contains the more advanced concepts about Siesta tests. It does not target any specific execution environment, like browser or Node.js, instead it assumes plain EcmaScript setup.</p>
<p>For introductory information, please refer to the <a href="Guide__Testing_basics.html#SiestaTestBasicsGuide">Siesta test basics</a> guide.</p>

<a href="#testing-asynchronous-code" id="testing-asynchronous-code" style="color: inherit; text-decoration: none;">
  <h1>Testing asynchronous code</h1>
</a>
<p>In the simplest form, when testing the asynchronous code, you can just make your test function <code>async</code> and use <code>await</code> where needed:</p>
<pre><code class="language-javascript"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">it</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-4">&quot;@bryntum/siesta/index.js&quot;</span><br/><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">MyClass</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-4">&quot;my-lib&quot;</span><br/><br/><span class="hl-3">it</span><span class="hl-0">(</span><span class="hl-4">&#39;Testing promise-based asynchronous code&#39;</span><span class="hl-0">, </span><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-2">t</span><span class="hl-0"> </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-9">myClass</span><span class="hl-0">       = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-3">MyClass</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-2">myClass</span><span class="hl-0">.</span><span class="hl-3">asyncMethod</span><span class="hl-0">(</span><span class="hl-4">&#39;do something&#39;</span><span class="hl-0">)</span><br/><span class="hl-0">})</span>
</code></pre>
<p>Sometimes, for example if code is using callbacks, you might not have the <code>Promise</code> instance to <code>await</code> for. In such case, use a pair of
<a href="../classes/index.Test.html#beginAsync">beginAsync</a>/<a href="../classes/index.Test.html#endAsync">endAsync</a> calls to indicate the beginning/ending of the asynchronous &quot;gap&quot; in the code flow.
Siesta will await for all <a href="../classes/index.Test.html#beginAsync">beginAsync</a> calls to complete with the corresponding <a href="../classes/index.Test.html#endAsync">endAsync</a> call, before finalizing the test. If the asynchronous gap does not end within <a href="../classes/index._internal_.TestDescriptor.html#defaultTimeout">TestDescriptor.defaultTimeout</a> time, it is finalized forcefully and failed assertion added to the test.</p>
<p>For example:</p>
<pre><code class="language-javascript"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">it</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-4">&quot;@bryntum/siesta/index.js&quot;</span><br/><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">MyClass</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-4">&quot;my-lib&quot;</span><br/><br/><span class="hl-3">it</span><span class="hl-0">(</span><span class="hl-4">&#39;Testing callbacks-based asynchronous code&#39;</span><span class="hl-0">, </span><span class="hl-2">t</span><span class="hl-0"> </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-9">myClass</span><span class="hl-0">        = </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-3">MyClass</span><span class="hl-0">()</span><br/><br/><span class="hl-0">    </span><span class="hl-5">// indicate async gap starts, test will remain active till</span><br/><span class="hl-0">    </span><span class="hl-5">// `endAsync()` call (but no longer than defatul timeout)</span><br/><span class="hl-0">    </span><span class="hl-6">const</span><span class="hl-0"> </span><span class="hl-9">gap</span><span class="hl-0">           = </span><span class="hl-2">t</span><span class="hl-0">.</span><span class="hl-3">beginAsync</span><span class="hl-0">()</span><br/><br/><span class="hl-0">    </span><span class="hl-2">myClass</span><span class="hl-0">.</span><span class="hl-3">asyncMethodWithCallback</span><span class="hl-0">(() </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-5">// indicate async gap completes</span><br/><span class="hl-0">        </span><span class="hl-2">t</span><span class="hl-0">.</span><span class="hl-3">endAsync</span><span class="hl-0">(</span><span class="hl-2">gap</span><span class="hl-0">)</span><br/><span class="hl-0">    })</span><br/><span class="hl-0">})</span>
</code></pre>

<a href="#tests-configuration" id="tests-configuration" style="color: inherit; text-decoration: none;">
  <h1>Tests configuration</h1>
</a>
<p>The configuration object of the nested test section &quot;extends&quot; the configuration object of the parent section. </p>
<p>For example if parent section sets the <a href="../classes/index._internal_.TestDescriptor.html#defaultTimeout">defaultTimeout</a> to a certain value, the nested section 
will use that value too.</p>
<pre><code class="language-javascript"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">it</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-4">&quot;@bryntum/siesta/index.js&quot;</span><br/><br/><span class="hl-3">it</span><span class="hl-0">({ </span><span class="hl-2">title :</span><span class="hl-0"> </span><span class="hl-4">&#39;Test section&#39;</span><span class="hl-0">, </span><span class="hl-2">defaultTimeout :</span><span class="hl-0"> </span><span class="hl-7">1000</span><span class="hl-0"> }, </span><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-2">t</span><span class="hl-0"> </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-2">t</span><span class="hl-0">.</span><span class="hl-3">it</span><span class="hl-0">(</span><span class="hl-4">&#39;Nested test section&#39;</span><span class="hl-0">, </span><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-2">t</span><span class="hl-0"> </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-5">// will fail within 1s</span><br/><span class="hl-0">        </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-2">t</span><span class="hl-0">.</span><span class="hl-3">waitFor</span><span class="hl-0">(() </span><span class="hl-6">=&gt;</span><span class="hl-0"> </span><span class="hl-6">false</span><span class="hl-0">)</span><br/><span class="hl-0">    })</span><br/><span class="hl-0">})</span>
</code></pre>

<a href="#exceptions" id="exceptions" style="color: inherit; text-decoration: none;">
  <h1>Exceptions</h1>
</a>
<p>If you need to verify that some function throws the exception, use the <a href="../classes/index.Test.html#throws">throws</a> assertion.
In the similar way, to verify that function does not throw exception, there&#39;s <a href="../classes/index.Test.html#doesNotThrow">doesNotThrow</a>. </p>
<p>Also, the test code may throw some unexpected exception. If it is thrown from the test function, it is caught 
and reported in the test results log. This is also true for the promise rejections in the <code>async</code> test function 
code flow. These are &quot;normal&quot; exceptions, since they can be caught with the <code>try/catch</code> block on the test function.</p>
<p>For example:</p>
<pre><code class="language-javascript"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">it</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-4">&quot;@bryntum/siesta/index.js&quot;</span><br/><br/><span class="hl-3">it</span><span class="hl-0">(</span><span class="hl-4">&#39;Test section&#39;</span><span class="hl-0">, </span><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-2">t</span><span class="hl-0"> </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">// &quot;normal&quot; exception</span><br/><span class="hl-0">    </span><span class="hl-1">throw</span><span class="hl-0"> </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">Error</span><span class="hl-0">(</span><span class="hl-4">&quot;I&#39;m exceptional&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">})</span>
</code></pre>
<p>However, test code may throw exception in the way, that it can not be caught using <code>try/catch</code> on the test function.
This is the case for example, if exception is thrown in <code>setTimeout</code> handler, or if the new <code>Promise</code> instance,
not included in the test function code flow, is rejected.</p>
<p>For example:</p>
<pre><code class="language-javascript"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">it</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-4">&quot;@bryntum/siesta/index.js&quot;</span><br/><br/><span class="hl-3">it</span><span class="hl-0">(</span><span class="hl-4">&#39;Test section 1&#39;</span><span class="hl-0">, </span><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-2">t</span><span class="hl-0"> </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">setTimeout</span><span class="hl-0">(() </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-5">// exception is thrown after 3s, </span><br/><span class="hl-0">        </span><span class="hl-5">// there might be some other test running by that time</span><br/><span class="hl-0">        </span><span class="hl-1">throw</span><span class="hl-0"> </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">Error</span><span class="hl-0">(</span><span class="hl-4">&#39;Oh, no&#39;</span><span class="hl-0">)</span><br/><span class="hl-0">    }, </span><span class="hl-7">3000</span><span class="hl-0">)</span><br/><span class="hl-0">})</span><br/><br/><span class="hl-3">it</span><span class="hl-0">(</span><span class="hl-4">&#39;Test section 1&#39;</span><span class="hl-0">, </span><span class="hl-6">async</span><span class="hl-0"> </span><span class="hl-2">t</span><span class="hl-0"> </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">// promise outside of the test function code flow</span><br/><span class="hl-0">    </span><span class="hl-6">new</span><span class="hl-0"> </span><span class="hl-8">Promise</span><span class="hl-0">((</span><span class="hl-2">resolve</span><span class="hl-0">, </span><span class="hl-2">reject</span><span class="hl-0">) </span><span class="hl-6">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-3">setTimeout</span><span class="hl-0">(</span><span class="hl-2">reject</span><span class="hl-0">, </span><span class="hl-7">3000</span><span class="hl-0">)</span><br/><span class="hl-0">    })</span><br/><span class="hl-0">})</span>
</code></pre>
<p>These are so called &quot;unhandled&quot; exceptions/rejections. If environment supports that (browsers and Node.js do, Deno doesn&#39;t), 
Siesta tracks such &quot;unhandled&quot; exceptions and report them <em>in the results log of the currently running test</em>. 
That might not be a test that was the cause of the exception! Unfortunately there&#39;s no easy way to determine
the test that caused the &quot;unhandled&quot; exception. We might revisit this topic in the following releases.</p>

<a href="#logging" id="logging" style="color: inherit; text-decoration: none;">
  <h1>Logging</h1>
</a>
<p>The <a href="../classes/index.Test.html">Test</a> class implements several logging methods:</p>
<ul>
<li><a href="../classes/index.Test.html#error">Test.error</a></li>
<li><a href="../classes/index.Test.html#warn">Test.warn</a></li>
<li><a href="../classes/index.Test.html#log">Test.log</a></li>
<li><a href="../classes/index.Test.html#debug">Test.debug</a></li>
<li><a href="../classes/index.Test.html#info">Test.info</a></li>
</ul>
<p>One can use them to report some useful information from test.</p>
<p>Note, that only the log messages which are at the current log level (or higher) are reported. The current log level is determined with the
<code>--log-level</code> command line option. By default its <code>warn</code></p>

<a href="#console-and-stdoutstderr-output" id="console-and-stdoutstderr-output" style="color: inherit; text-decoration: none;">
  <h1>Console and stdout/stderr output</h1>
</a>
<p>If test performs calls to console, like <code>console.log()</code> or writes to <code>stdout/stderr</code>, Siesta intercepts such calls/writes
and routes them into the test log. </p>

<a href="#project" id="project" style="color: inherit; text-decoration: none;">
  <h1>Project</h1>
</a>
<p>If you want to provide configuration for the whole test suite, you need to create a <a href="Guide__Siesta_project.html#SiestaProjectGuide">Siesta project</a>.</p>

<a href="#reports" id="reports" style="color: inherit; text-decoration: none;">
  <h1>Reports</h1>
</a>
<p>You might want to receive the results of the test suite execution in some structured format for your own processing.
Siesta can generate reports in JSON, JUnit and HTML formats.</p>
<p>See the <a href="Guide__Reports.html#ReportsGuide">Reports guide</a>.</p>

<a href="#copyright-and-license" id="copyright-and-license" style="color: inherit; text-decoration: none;">
  <h1>COPYRIGHT AND LICENSE</h1>
</a>
<p>MIT License</p>
<p>Copyright (c) 2009-2021 Bryntum, Nickolay Platonov</p>
</div></div></section></section></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class=""><a href="../modules.html">Modules</a></li><li class=" tsd-kind-module"><a href="Guide__Auto_waiting.html">Guide: <wbr/>Auto waiting</a></li><li class=" tsd-kind-module"><a href="Guide__Getting_started_Deno.html">Guide: <wbr/>Getting started <wbr/>Deno</a></li><li class=" tsd-kind-module"><a href="Guide__Getting_started_Node_js.html">Guide: <wbr/>Getting started <wbr/>Node.js</a></li><li class=" tsd-kind-module"><a href="Guide__Getting_started_Sencha.html">Guide: <wbr/>Getting started <wbr/>Sencha</a></li><li class=" tsd-kind-module"><a href="Guide__Getting_started_browser.html">Guide: <wbr/>Getting started browser</a></li><li class=" tsd-kind-module"><a href="Guide__Reports.html">Guide: <wbr/>Reports</a></li><li class=" tsd-kind-module"><a href="Guide__Siesta_project.html">Guide: <wbr/>Siesta project</a></li><li class=" tsd-kind-module"><a href="Guide__Special_key_names.html">Guide: <wbr/>Special key names</a></li><li class="current tsd-kind-module"><a href="Guide__Testing_advanced.html">Guide: <wbr/>Testing advanced</a></li><li class=" tsd-kind-module"><a href="Guide__Testing_basics.html">Guide: <wbr/>Testing basics</a></li><li class=" tsd-kind-module"><a href="browser.html">browser</a></li><li class=" tsd-kind-module"><a href="deno.html">deno</a></li><li class=" tsd-kind-module"><a href="index.html">index</a></li><li class=" tsd-kind-module"><a href="nodejs.html">nodejs</a></li><li class=" tsd-kind-module"><a href="sencha.html">sencha</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-variable tsd-parent-kind-module"><a href="Guide__Testing_advanced.html#SiestaTestAdvancedGuide" class="tsd-kind-icon">Siesta<wbr/>Test<wbr/>Advanced<wbr/>Guide</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-namespace"><span class="tsd-kind-icon">Namespace</span></li><li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li><li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="../assets/main.js"></script></body></html>